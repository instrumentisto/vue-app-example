version: '3'

services:
  node:
    container_name: vue-app-example-node
    image: hub.instrumentisto.com/social/frontend:dev
    build: .
    expose:
      - "8080"        # express
    ports:
      - "8080:8080"
    volumes:
      - ./:/app
  nginx:
    container_name: vue-app-example-nginx
    image: nginx:stable-alpine
    depends_on:
      - node
      - json-server
    command: /bin/sh -c "sed -i -r 's/^user .*$$/user nobody;/g'
                             /etc/nginx/nginx.conf
                         && nginx -g 'daemon off;'"
    ports:
      - "80:80"       # http
    volumes:
      - ./_build/:/var/www/public:ro
      - ./.dev/nginx/vhost.conf:/etc/nginx/conf.d/default.conf:ro
  json-server:
    container_name: vue-app-example-json-server
    image: instrumentisto/node-builder
    working_dir: /app
    command: /bin/sh -c "npm run json-server"
    ports:
      - "3000:3000"   #json-server
    volumes:
      - ./:/app
